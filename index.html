<script>
    async function cargarCatalogo() {
        try {
            const respuesta = await fetch('libros.json');
            const libros = await respuesta.json();

            const contenedor = document.getElementById('estanteria');
            contenedor.innerHTML = '';

            if (libros.length === 0) {
                contenedor.innerHTML = '<p>No hay libros disponibles.</p>';
                return;
            }

            function formatearLibro(nombreArchivo) {
                const sinExtension = nombreArchivo.replace('.txt', '');
                const partes = sinExtension.split('_-_');
                let tituloRaw = partes[0] || 'sin_titulo';
                let autorRaw = partes[1] || 'autor_desconocido';

                const palabrasMinus = new Set(['y', 'de', 'la', 'el', 'los', 'las', 'un', 'una', 'del', 'por', 'en', 'a', 'o']);

                function capitalizar(str) {
                    return str.toLowerCase().split('_').join(' ').split(' ').map((palabra, index) => {
                        if (index === 0 || !palabrasMinus.has(palabra)) {
                            return palabra.charAt(0).toUpperCase() + palabra.slice(1);
                        }
                        return palabra;
                    }).join(' ');
                }

                const titulo = capitalizar(tituloRaw);
                const autor = capitalizar(autorRaw);

                return { titulo, autor, archivo: nombreArchivo };
            }

            libros.forEach(libro => {
                const info = formatearLibro(libro);
                const divLibro = document.createElement('div');
                divLibro.className = 'libro';
                divLibro.onclick = () => abrirLibro(info.archivo, `${info.titulo} - ${info.autor}`);

                divLibro.innerHTML = `
                    <h3>${info.titulo}</h3>
                    <p class="autor">${info.autor}</p>
                `;
                contenedor.appendChild(divLibro);
            });

        } catch (error) {
            document.getElementById('estanteria').innerHTML = '<p>Error al cargar el cat√°logo.</p>';
            console.error(error);
        }
    }

    function abrirLibro(archivo, titulo) {
        window.location.href = `lector.html?libro=${encodeURIComponent(archivo)}&titulo=${encodeURIComponent(titulo)}`;
    }

    window.onload = cargarCatalogo;
</script>
