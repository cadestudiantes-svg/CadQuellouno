<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Biblioteca Literaria Estudiantil</title>
    <link rel="stylesheet" href="css/estilos.css">
    <link href="https://fonts.googleapis.com/css2?family=Lora:wght@400;700&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
</head>
<body class="modo-claro">
    <header>
        <h1>Biblioteca Literaria Estudiantil</h1>
        <p>Selecciona un libro para leerlo</p>
    </header>

    <main id="estanteria" class="estanteria">
        <p>Cargando catálogo...</p>
    </main>

    <script>
        async function cargarCatalogo() {
            try {
                const respuesta = await fetch('libros.json');
                const libros = await respuesta.json();

                const contenedor = document.getElementById('estanteria');
                contenedor.innerHTML = '';

                if (libros.length === 0) {
                    contenedor.innerHTML = '<p>No hay libros disponibles.</p>';
                    return;
                }

                // Función para formatear títulos y autores en español correcto
                function formatearLibro(nombreArchivo) {
                    const sinExtension = nombreArchivo.replace('.txt', '');
                    const partes = sinExtension.split('_-_');
                    let tituloRaw = partes[0] || 'sin_titulo';
                    let autorRaw = partes[1] || 'autor_desconocido';

                    const palabrasMinus = new Set(['y', 'de', 'la', 'el', 'los', 'las', 'un', 'una', 'del', 'por', 'en', 'a', 'o']);

                    function capitalizar(str) {
                        return str.toLowerCase().split('_').join(' ').split(' ').map((palabra, index) => {
                            if (index === 0 || !palabrasMinus.has(palabra)) {
                                return palabra.charAt(0).toUpperCase() + palabra.slice(1);
                            }
                            return palabra;
                        }).join(' ');
                    }

                    const titulo = capitalizar(tituloRaw);
                    const autor = capitalizar(autorRaw);

                    return { titulo, autor, archivo: nombreArchivo };
                }

                // Orden alfabético opcional por título
                libros.sort();

      libros.forEach(libro => {
    // libro ahora es un objeto, no solo un string
    const info = formatearLibro(libro.archivo);
    const divLibro = document.createElement('div');
    divLibro.className = 'libro';
    
    // Pasar TRES parámetros: archivo, título completo y ENLACE
    divLibro.onclick = () => abrirLibro(
        libro.archivo, 
        `${info.titulo} - ${info.autor}`, 
        libro.enlace
    );

    divLibro.innerHTML = `
        <h3>${info.titulo}</h3>
        <p class="autor">${info.autor}</p>
    `;
    contenedor.appendChild(divLibro);
});

            } catch (error) {
                document.getElementById('estanteria').innerHTML = '<p>Error al cargar el catálogo. Verifica que libros.json exista.</p>';
                console.error(error);
            }
        }

function abrirLibro(archivo, titulo, enlace) {
    window.location.href = `lector.html?libro=${encodeURIComponent(archivo)}&titulo=${encodeURIComponent(titulo)}&enlace=${encodeURIComponent(enlace)}`;
}
        // Cargar el catálogo al abrir la página
        window.onload = cargarCatalogo;
    </script>
</body>
</html>



